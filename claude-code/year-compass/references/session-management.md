# Управление сессиями планирования

## Содержание

1. [Логика инициализации](#логика-инициализации)
2. [JSON-схема состояния сессии](#json-схема-состояния-сессии)
3. [Описание полей](#описание-полей)
4. [Статусы секций](#статусы-секций)
5. [Логика перерывов](#логика-перерывов)
6. [Отображение прогресса](#отображение-прогресса)
7. [Рекомендации по длительности](#рекомендации-по-длительности)
8. [Логика возобновления](#логика-возобновления)
9. [Workflow диаграммы](#workflow-диаграммы)

---

## Логика инициализации

### Когда запускать

Инициализация запускается командой `init` или автоматически при первом обращении к скиллу без существующего плана.

### Алгоритм инициализации

```
1. Проверить существование файлов:
   - {year}_annual_plan.md
   - .planning-session.json

2. Если файлы существуют:
   → Предложить: продолжить / начать заново (--force)

3. Если файлов нет:
   → Запросить выбор фреймворка
   → Создать пустой шаблон плана
   → Создать файл состояния сессии
   → Создать вспомогательные директории
```

### Скрипт инициализации

```bash
python scripts/init_plan.py --year 2026 --framework navigator
python scripts/init_plan.py --year 2026 --framework year-compass --output-dir ./Personal/Planning
python scripts/init_plan.py --year 2026 --framework hybrid --force
```

### Создаваемые файлы

| Файл | Назначение |
|------|------------|
| `{year}_annual_plan.md` | Пустой шаблон плана со всеми секциями |
| `.planning-session.json` | Состояние сессии (все секции = pending) |
| `{year}_monthly/` | Папка для месячных планов |
| `archive/` | Папка для архивных версий |

### Структура пустого шаблона

Каждая секция в шаблоне содержит:
```markdown
### 1.1 Название секции
**Глубина:** ☆☆☆☆☆ (не заполнено)

<!-- TODO: Заполнить -->
```

### Диалог после инициализации

```markdown
## План создан!

✅ Создан: Personal/Planning/2026_annual_plan.md
✅ Создан: Personal/Planning/.planning-session.json

**Фреймворк:** Navigator
**Секций:** 15

### Готовы начать?

Первый раздел — «Обзор календаря».
Откройте календарь за прошлый год и пройдитесь по месяцам.

Начнём? (да / позже)
```

---

## JSON-схема состояния сессии

Файл `.planning-session.json` хранится в корне директории планирования.

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["framework", "year", "created_at", "sections"],
  "properties": {
    "framework": {
      "type": "string",
      "enum": ["navigator", "year-compass", "hybrid"]
    },
    "year": {
      "type": "integer",
      "minimum": 2020,
      "maximum": 2100
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "last_session": {
      "type": "object",
      "properties": {
        "started_at": { "type": "string", "format": "date-time" },
        "ended_at": { "type": "string", "format": "date-time" },
        "duration_minutes": { "type": "integer" },
        "section": { "type": "string" }
      }
    },
    "sections": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/section"
      }
    },
    "total_time_minutes": { "type": "integer" },
    "breaks_taken": { "type": "integer" }
  },
  "definitions": {
    "section": {
      "type": "object",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["pending", "in_progress", "completed", "skipped", "partial"]
        },
        "depth": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5,
          "description": "Глубина проработки: 1=формально, 3=достаточно для первого прохода, 5=исчерпывающе"
        },
        "iteration": {
          "type": "integer",
          "minimum": 1,
          "description": "Номер итерации заполнения (1=первый проход)"
        },
        "started_at": { "type": "string", "format": "date-time" },
        "completed_at": { "type": "string", "format": "date-time" },
        "duration_minutes": { "type": "integer" },
        "prompts_completed": { "type": "array", "items": { "type": "string" } },
        "prompts_skipped": { "type": "array", "items": { "type": "string" } }
      }
    }
  }
}
```

---

## Описание полей

| Поле | Тип | Описание |
|------|-----|----------|
| `framework` | string | Используемый фреймворк (`year-compass` или расширенный) |
| `year` | integer | Год планирования |
| `created_at` | datetime | Дата создания сессии |
| `last_session.started_at` | datetime | Начало последней сессии работы |
| `last_session.ended_at` | datetime | Завершение последней сессии |
| `last_session.duration_minutes` | integer | Продолжительность последней сессии |
| `last_session.section` | string | Секция, над которой работали |
| `sections` | object | Словарь всех секций и их состояния |
| `total_time_minutes` | integer | Общее время работы над планом |
| `breaks_taken` | integer | Количество взятых перерывов |

---

## Статусы секций

| Статус | Значение | Действие при возобновлении |
|--------|----------|---------------------------|
| `pending` | Не начата | Начать с первого промпта |
| `in_progress` | В процессе | Продолжить с последнего промпта |
| `completed` | Завершена | Пропустить (предложить ревью) |
| `skipped` | Пропущена осознанно | Предложить вернуться позже |
| `partial` | Частично заполнена | Показать незаполненные промпты |

---

## Логика перерывов

### Триггеры для предложения перерыва

1. **Временной триггер**: работа >45 минут без перерыва
2. **Эмоциональный триггер**: после секций:
   - `lessons_learned` (уроки года)
   - `forgiveness` (прощение)
   - `grief` (потери и расставания)
   - `blockers` (страхи и блоки)
3. **Количественный триггер**: после завершения 3 секций подряд

### Типы перерывов

| Тип | Длительность | Когда предлагать |
|-----|--------------|------------------|
| **Короткий** | 5-10 мин | После 45 мин работы, между секциями |
| **Средний** | 15-30 мин | После эмоциональных секций |
| **Длинный** | До следующего дня | После Part 1, при усталости |

### Формулировка предложения перерыва

```markdown
---
**Пауза для интеграции**

Вы работаете уже {duration} минут. Секция "{section}" требует
эмоциональной обработки.

Рекомендую:
- [ ] Короткий перерыв (5-10 мин) — прогулка, вода
- [ ] Средний перерыв (15-30 мин) — смена деятельности
- [ ] Продолжить завтра — если чувствуете усталость

Ваш прогресс сохранён. Введите "продолжить" когда будете готовы.
---
```

---

## Отображение прогресса

### Формат таблицы прогресса

```markdown
## Прогресс заполнения (итерация 1)

### Часть 1: Ретроспектива
| Секция | Статус | Глубина | Время |
|--------|--------|---------|-------|
| [x] Обзор месяцев | Завершено | ⭐⭐⭐☆☆ | 25 мин |
| [x] Победы года | Завершено | ⭐⭐⭐⭐☆ | 15 мин |
| [~] Уроки и инсайты | В процессе | ⭐⭐☆☆☆ | 10 мин |
| [ ] Карта энергии | Ожидает | — | — |
| [ ] Итоги года | Ожидает | — | — |

### Часть 2: Планирование
| Секция | Статус | Глубина | Время |
|--------|--------|---------|-------|
| [ ] Видение 3-5 лет | Ожидает | — | — |
| [ ] Приоритет 1 | Ожидает | — | — |
| [ ] Приоритет 2 | Ожидает | — | — |
| [ ] Приоритет 3 | Ожидает | — | — |
| [ ] 10 желаний | Ожидает | — | — |
| [ ] Pre-mortem | Ожидает | — | — |

**Общий прогресс:** 3/11 секций (27%)
**Средняя глубина:** ⭐⭐⭐☆☆ (3.0/5) — достаточно для первого прохода!
**Затрачено времени:** 50 минут
**Перерывов:** 1

---
💡 Для первой итерации цель — пройти все секции на глубине 3/5.
   Углубить можно позже через команду `deepen [секция]`.
```

### Индикатор глубины

| Глубина | Символ | Что означает | Для первого прохода |
|---------|--------|--------------|---------------------|
| 1/5 | ⭐☆☆☆☆ | Формально, без деталей | ⚠️ Слишком поверхностно |
| 2/5 | ⭐⭐☆☆☆ | Есть основа | ⚠️ Желательно углубить |
| 3/5 | ⭐⭐⭐☆☆ | Достаточно проработано | ✅ Цель первого прохода |
| 4/5 | ⭐⭐⭐⭐☆ | Глубоко проработано | ✅ Отлично |
| 5/5 | ⭐⭐⭐⭐⭐ | Исчерпывающе | ✅ Превосходно |

### Сигналы для оценки глубины

**Глубина 1-2 (недостаточно):**
- Ответы из 1-3 слов
- Общие фразы («всё хорошо», «было нормально»)
- Нет конкретных примеров
- Отсутствует эмоциональная окраска

**Глубина 3 (достаточно для первого прохода):**
- Есть 2-3 конкретных примера
- Присутствуют детали (даты, имена, события)
- Есть рефлексия («понял, что...», «осознал...»)

**Глубина 4-5 (глубокая проработка):**
- Связи между событиями и выводами
- Эмоциональная честность
- Инсайты и паттерны
- Применимые уроки

---

## Рекомендации по длительности

| Секция | Мин. время | Рек. время | Макс. время |
|--------|------------|------------|-------------|
| Обзор месяцев | 15 мин | 30 мин | 45 мин |
| Победы года | 10 мин | 20 мин | 30 мин |
| Уроки и инсайты | 15 мин | 25 мин | 40 мин |
| Карта энергии | 10 мин | 15 мин | 25 мин |
| Итоги года | 10 мин | 20 мин | 30 мин |
| Видение 3-5 лет | 15 мин | 30 мин | 45 мин |
| Каждый приоритет | 20 мин | 40 мин | 60 мин |
| 10 желаний | 10 мин | 20 мин | 30 мин |
| Pre-mortem | 15 мин | 25 мин | 35 мин |

**Общее рекомендуемое время:** 4-6 часов (с перерывами)

---

## Логика возобновления

### Алгоритм при команде "продолжить"

1. Загрузить `.planning-session.json`
2. Найти первую секцию со статусом `in_progress` или `partial`
3. Если нет — найти первую `pending`
4. Показать краткое резюме прогресса
5. Предложить:
   - Продолжить с места остановки
   - Вернуться к пропущенным секциям
   - Перепроверить завершённые секции

### Формат возобновления

```markdown
## Добро пожаловать обратно!

**Последняя сессия:** {last_session_date}, {duration} мин
**Вы остановились на:** {section_name}

### Ваш прогресс:
- Завершено: {completed_count} секций
- В процессе: {in_progress_section}
- Осталось: {pending_count} секций

### Варианты:
1. **Продолжить** — вернуться к "{in_progress_section}"
2. **Обзор** — посмотреть заполненное
3. **Пропущенные** — вернуться к пропущенным секциям

Что выбираете?
```

---

## Workflow диаграммы

### Filling Mode

```
┌──────────────────────────────────────────────────────────────────┐
│                        FILLING MODE                               │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  START                                                            │
│    │                                                              │
│    ▼                                                              │
│  ┌─────────────────┐                                              │
│  │ Framework?      │──No──▶ Framework Selection                   │
│  └────────┬────────┘                                              │
│           │ Yes                                                   │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ Load status     │                                              │
│  │ Show progress   │                                              │
│  └────────┬────────┘                                              │
│           │                                                       │
│           ▼                                                       │
│  ┌─────────────────┐     ┌──────────────────┐                    │
│  │ Current section │────▶│ Guide through    │                    │
│  │ (in_progress)   │     │ prompts + methods│                    │
│  └────────┬────────┘     └────────┬─────────┘                    │
│           │                       │                               │
│           ▼                       ▼                               │
│  ┌─────────────────┐     ┌──────────────────┐                    │
│  │ Check duration  │     │ Apply evidence-  │                    │
│  │ > 45 min?       │     │ based method     │                    │
│  └────────┬────────┘     └──────────────────┘                    │
│           │                                                       │
│      Yes  │  No                                                   │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ Suggest break   │                                              │
│  │ Save progress   │                                              │
│  └─────────────────┘                                              │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

### Maintenance Mode

```
┌──────────────────────────────────────────────────────────────────┐
│                      MAINTENANCE MODE                             │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  MONTHLY TRIGGER (first week)                                     │
│    │                                                              │
│    ▼                                                              │
│  ┌─────────────────┐                                              │
│  │ Load priorities │                                              │
│  │ Show progress   │                                              │
│  └────────┬────────┘                                              │
│           │                                                       │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ For each        │                                              │
│  │ priority:       │                                              │
│  │ • Progress?     │                                              │
│  │ • Obstacles?    │                                              │
│  │ • Adjust?       │                                              │
│  └────────┬────────┘                                              │
│           │                                                       │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ Energy check    │                                              │
│  │ Lessons learned │                                              │
│  │ Next month plan │                                              │
│  └────────┬────────┘                                              │
│           │                                                       │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ Update files    │                                              │
│  │ Schedule next   │                                              │
│  └─────────────────┘                                              │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

Last Updated: 2026-01-03
