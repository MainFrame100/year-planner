# Управление сессиями планирования (Web/Desktop)

## Содержание

1. [Логика инициализации](#логика-инициализации)
2. [YAML-схема состояния сессии](#yaml-схема-состояния-сессии)
3. [Описание полей](#описание-полей)
4. [Статусы секций](#статусы-секций)
5. [Логика перерывов](#логика-перерывов)
6. [Отображение прогресса](#отображение-прогресса)
7. [Рекомендации по длительности](#рекомендации-по-длительности)
8. [Логика возобновления](#логика-возобновления)
9. [Workflow диаграммы](#workflow-диаграммы)
10. [Работа с артефактами](#работа-с-артефактами)

---

## Логика инициализации

### Когда запускать

Инициализация запускается при первом обращении к скиллу или когда в Project нет файла плана.

### Алгоритм инициализации

```
1. Проверить наличие файла в Project:
   - annual_plan_*.md

2. Если файл существует:
   → Скопировать полностью в новый артефакт
   → Прочитать frontmatter
   → Продолжить с current_section

3. Если файла нет:
   → Запросить выбор фреймворка
   → Создать артефакт с пустым шаблоном
   → Начать с первой секции
```

### Создаваемый артефакт

| Элемент | Назначение |
|---------|------------|
| YAML frontmatter | Состояние сессии (все секции = pending) |
| Markdown контент | Шаблон плана со всеми секциями |

### Структура пустого шаблона

Каждая секция в шаблоне содержит:
```markdown
### 1.1 Название секции
**Глубина:** ☆☆☆☆☆ (не заполнено)

<!-- TODO: Заполнить -->
```

### Диалог после инициализации

```markdown
## План создан!

Артефакт "Годовой план 2026" готов к заполнению.

**Фреймворк:** Navigator
**Секций:** 15

### Готовы начать?

Первый раздел — «Обзор календаря».
Откройте календарь за прошлый год и пройдитесь по месяцам.

Начнём? (да / позже)

💾 **Совет:** Создайте Project "Годовой план 2026" и сохраните
   туда артефакт после каждой сессии.
```

---

## YAML-схема состояния сессии

Состояние хранится в YAML frontmatter артефакта.

```yaml
---
title: Годовой план 2026
framework: navigator  # navigator | year-compass | hybrid
year: 2026
language: ru
created: 2026-01-05
last_session: 2026-01-05T15:30:00
current_section: lessons
total_time_minutes: 95
sessions_count: 3
breaks_taken: 2

sections:
  month_review:
    status: completed      # pending | in_progress | completed | skipped | partial
    depth: 3               # 1-5
    iteration: 1           # номер прохода
    started_at: 2026-01-03T10:00:00
    completed_at: 2026-01-03T10:45:00
    duration_minutes: 45

  victories:
    status: completed
    depth: 4
    iteration: 1
    duration_minutes: 20

  lessons:
    status: in_progress
    depth: 2
    iteration: 1
    duration_minutes: 15

  energy_map:
    status: pending

  year_summary:
    status: pending

  vision:
    status: pending

  priority_1:
    status: pending

  priority_2:
    status: pending

  priority_3:
    status: pending

  wishes:
    status: pending

  premortem:
    status: pending

  commitment:
    status: pending
---
```

---

## Описание полей

| Поле | Тип | Описание |
|------|-----|----------|
| `framework` | string | Используемый фреймворк (`year-compass`, `navigator`, `hybrid`) |
| `year` | integer | Год планирования |
| `created` | date | Дата создания плана |
| `last_session` | datetime | Начало последней сессии работы |
| `current_section` | string | Секция, где остановились |
| `sections` | object | Словарь всех секций и их состояния |
| `total_time_minutes` | integer | Общее время работы над планом |
| `sessions_count` | integer | Количество сессий |
| `breaks_taken` | integer | Количество взятых перерывов |

### Поля секции

| Поле | Тип | Описание |
|------|-----|----------|
| `status` | string | Статус секции |
| `depth` | integer | Глубина проработки (1-5) |
| `iteration` | integer | Номер прохода |
| `started_at` | datetime | Когда начали работу |
| `completed_at` | datetime | Когда завершили |
| `duration_minutes` | integer | Время работы над секцией |

---

## Статусы секций

| Статус | Значение | Действие при возобновлении |
|--------|----------|---------------------------|
| `pending` | Не начата | Начать с первого промпта |
| `in_progress` | В процессе | Продолжить с последнего промпта |
| `completed` | Завершена | Пропустить (предложить ревью) |
| `skipped` | Пропущена осознанно | Предложить вернуться позже |
| `partial` | Частично заполнена | Показать незаполненные промпты |

---

## Логика перерывов

### Триггеры для предложения перерыва

1. **Временной триггер**: работа >45 минут без перерыва
2. **Эмоциональный триггер**: после секций:
   - `lessons_learned` (уроки года)
   - `forgiveness` (прощение)
   - `grief` (потери и расставания)
   - `blockers` (страхи и блоки)
3. **Количественный триггер**: после завершения 3 секций подряд

### Типы перерывов

| Тип | Длительность | Когда предлагать |
|-----|--------------|------------------|
| **Короткий** | 5-10 мин | После 45 мин работы, между секциями |
| **Средний** | 15-30 мин | После эмоциональных секций |
| **Длинный** | До следующего дня | После Part 1, при усталости |

### Формулировка предложения перерыва

```markdown
---
**Пауза для интеграции**

Вы работаете уже {duration} минут. Секция "{section}" требует
эмоциональной обработки.

Рекомендую:
- [ ] Короткий перерыв (5-10 мин) — прогулка, вода
- [ ] Средний перерыв (15-30 мин) — смена деятельности
- [ ] Продолжить завтра — если чувствуете усталость

💾 Сохраните артефакт в Project перед перерывом!

Напишите "продолжить" когда будете готовы.
---
```

---

## Отображение прогресса

### Формат таблицы прогресса

```markdown
## Прогресс заполнения (итерация 1)

### Часть 1: Ретроспектива
| Секция | Статус | Глубина | Время |
|--------|--------|---------|-------|
| [x] Обзор месяцев | Завершено | ⭐⭐⭐☆☆ | 25 мин |
| [x] Победы года | Завершено | ⭐⭐⭐⭐☆ | 15 мин |
| [~] Уроки и инсайты | В процессе | ⭐⭐☆☆☆ | 10 мин |
| [ ] Карта энергии | Ожидает | — | — |
| [ ] Итоги года | Ожидает | — | — |

### Часть 2: Планирование
| Секция | Статус | Глубина | Время |
|--------|--------|---------|-------|
| [ ] Видение 3-5 лет | Ожидает | — | — |
| [ ] Приоритет 1 | Ожидает | — | — |
| [ ] Приоритет 2 | Ожидает | — | — |
| [ ] Приоритет 3 | Ожидает | — | — |
| [ ] 10 желаний | Ожидает | — | — |
| [ ] Pre-mortem | Ожидает | — | — |

**Общий прогресс:** 3/11 секций (27%)
**Средняя глубина:** ⭐⭐⭐☆☆ (3.0/5) — достаточно для первого прохода!
**Затрачено времени:** 50 минут
**Перерывов:** 1

---
💡 Для первой итерации цель — пройти все секции на глубине 3/5.
   Углубить можно позже через команду `deepen [секция]`.
```

### Индикатор глубины

| Глубина | Символ | Что означает | Для первого прохода |
|---------|--------|--------------|---------------------|
| 1/5 | ⭐☆☆☆☆ | Формально, без деталей | ⚠️ Слишком поверхностно |
| 2/5 | ⭐⭐☆☆☆ | Есть основа | ⚠️ Желательно углубить |
| 3/5 | ⭐⭐⭐☆☆ | Достаточно проработано | ✅ Цель первого прохода |
| 4/5 | ⭐⭐⭐⭐☆ | Глубоко проработано | ✅ Отлично |
| 5/5 | ⭐⭐⭐⭐⭐ | Исчерпывающе | ✅ Превосходно |

### Сигналы для оценки глубины

**Глубина 1-2 (недостаточно):**
- Ответы из 1-3 слов
- Общие фразы («всё хорошо», «было нормально»)
- Нет конкретных примеров
- Отсутствует эмоциональная окраска

**Глубина 3 (достаточно для первого прохода):**
- Есть 2-3 конкретных примера
- Присутствуют детали (даты, имена, события)
- Есть рефлексия («понял, что...», «осознал...»)

**Глубина 4-5 (глубокая проработка):**
- Связи между событиями и выводами
- Эмоциональная честность
- Инсайты и паттерны
- Применимые уроки

---

## Рекомендации по длительности

| Секция | Мин. время | Рек. время | Макс. время |
|--------|------------|------------|-------------|
| Обзор месяцев | 15 мин | 30 мин | 45 мин |
| Победы года | 10 мин | 20 мин | 30 мин |
| Уроки и инсайты | 15 мин | 25 мин | 40 мин |
| Карта энергии | 10 мин | 15 мин | 25 мин |
| Итоги года | 10 мин | 20 мин | 30 мин |
| Видение 3-5 лет | 15 мин | 30 мин | 45 мин |
| Каждый приоритет | 20 мин | 40 мин | 60 мин |
| 10 желаний | 10 мин | 20 мин | 30 мин |
| Pre-mortem | 15 мин | 25 мин | 35 мин |

**Общее рекомендуемое время:** 4-6 часов (с перерывами)

---

## Логика возобновления

### Алгоритм при продолжении

1. Найти файл `annual_plan_*.md` в Project
2. **Скопировать его ПОЛНОСТЬЮ в новый артефакт** (важно!)
3. Прочитать YAML frontmatter
4. Найти `current_section`
5. Показать краткое резюме прогресса
6. Предложить варианты продолжения

### Формат возобновления

```markdown
## Добро пожаловать обратно!

**Последняя сессия:** {last_session_date}
**Вы остановились на:** {section_name}

### Ваш прогресс:
- Завершено: {completed_count} секций
- В процессе: {in_progress_section}
- Осталось: {pending_count} секций

### Варианты:
1. **Продолжить** — вернуться к "{in_progress_section}"
2. **Обзор** — посмотреть заполненное
3. **Пропущенные** — вернуться к пропущенным секциям

Что выбираете?
```

---

## Workflow диаграммы

### Filling Mode (Web/Desktop)

```
┌──────────────────────────────────────────────────────────────────┐
│                    FILLING MODE (Artifacts)                       │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  START                                                            │
│    │                                                              │
│    ▼                                                              │
│  ┌─────────────────┐                                              │
│  │ File in Project?│──No──▶ Framework Selection                   │
│  └────────┬────────┘        Create new artifact                   │
│           │ Yes                                                   │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ Copy FULL file  │                                              │
│  │ to new artifact │                                              │
│  │ (nothing lost!) │                                              │
│  └────────┬────────┘                                              │
│           │                                                       │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ Read frontmatter│                                              │
│  │ Find current_   │                                              │
│  │ section         │                                              │
│  └────────┬────────┘                                              │
│           │                                                       │
│           ▼                                                       │
│  ┌─────────────────┐     ┌──────────────────┐                    │
│  │ Current section │────▶│ Guide through    │                    │
│  │ (in_progress)   │     │ prompts + methods│                    │
│  └────────┬────────┘     └────────┬─────────┘                    │
│           │                       │                               │
│           ▼                       ▼                               │
│  ┌─────────────────┐     ┌──────────────────┐                    │
│  │ Update artifact │     │ Apply evidence-  │                    │
│  │ (section +      │     │ based method     │                    │
│  │  frontmatter)   │     └──────────────────┘                    │
│  └────────┬────────┘                                              │
│           │                                                       │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ Check duration  │──▶ Yes ──▶ Suggest break                    │
│  │ > 45 min?       │           Remind to save                    │
│  └────────┬────────┘                                              │
│           │ No                                                    │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ END SESSION     │                                              │
│  │ • Verify content│                                              │
│  │ • Update YAML   │                                              │
│  │ • Remind: Save! │                                              │
│  └─────────────────┘                                              │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

### Maintenance Mode

```
┌──────────────────────────────────────────────────────────────────┐
│                      MAINTENANCE MODE                             │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  MONTHLY TRIGGER (first week)                                     │
│    │                                                              │
│    ▼                                                              │
│  ┌─────────────────┐                                              │
│  │ Load plan from  │                                              │
│  │ Project         │                                              │
│  └────────┬────────┘                                              │
│           │                                                       │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ For each        │                                              │
│  │ priority:       │                                              │
│  │ • Progress?     │                                              │
│  │ • Obstacles?    │                                              │
│  │ • Adjust?       │                                              │
│  └────────┬────────┘                                              │
│           │                                                       │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ Energy check    │                                              │
│  │ Lessons learned │                                              │
│  │ Next month plan │                                              │
│  └────────┬────────┘                                              │
│           │                                                       │
│           ▼                                                       │
│  ┌─────────────────┐                                              │
│  │ Update artifact │                                              │
│  │ Remind: Save!   │                                              │
│  └─────────────────┘                                              │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## Работа с артефактами

### Критические правила

1. **В начале сессии:** ВСЕГДА копировать весь файл в новый артефакт целиком
2. **Во время сессии:** обновлять конкретные секции, НЕ перегенерировать всё
3. **В конце сессии:**
   - Проверить что ничего не потеряно
   - Обновить YAML frontmatter
   - Напомнить: «Сохраните в Project, старую версию удалите»

### Проверка целостности (конец сессии)

```markdown
## Проверка перед сохранением

✅ Все секции на месте
✅ YAML frontmatter обновлён
✅ current_section = {current}
✅ total_time_minutes = {total}

### За эту сессию заполнено:
- {section_1}: глубина {depth}
- {section_2}: глубина {depth}

### Следующая сессия начнётся с:
- {next_section}

---
💾 **Сохраните артефакт в Project** (Add to Project)
🗑️ **Удалите старую версию** из Project
```

---

Last Updated: 2026-01-05
